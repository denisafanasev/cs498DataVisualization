<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Denis Afanasev">
    <link rel="icon" href="index.html">

    <title>CS498 Data Visualization (denisa2)</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <style> circle {fill: lightblue; stroke: black;} </style>
    <!-- Custom styles for this template -->
  </head>

  <body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark static-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                CS498 Data visualization: data visualization
            </a>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                    <a class="nav-link" href="index.html">Description</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="data_visualization.html">Visualization</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Page Content -->
    <div class="container">
        <div class="card">
            <div class="card-header">
                Scene Title
            </div>
            <div class="card-body">
                <div>
                    Scene description <br><br>
                </div>
                <div>
                    <svg height=300 width="100%" id="graph">
                    </svg>
                </div>
                <div class=".text-center">
                    <button type="button" class="btn btn-secondary btn-sm">Small button</button>
                    <button type="button" class="btn btn-secondary btn-sm">Small button</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /.container -->
    <script> 
        async function renderGraph() {
                console.log("function start")
                const data = await d3.csv('https://flunky.github.io/cars2017.csv');
                console.log("data download done")

                const margin = 50;
                const width = 300;
                const height = 300;

                data.forEach(function(d) {
                    d.EngineCylinders = + d.EngineCylinders;
                    d.AverageCityMPG = + d.AverageCityMPG;
                    d.AverageHighwayMPG = + d.AverageHighwayMPG;
                });

                var graph_width = parseInt(d3.select("svg").style("width").replace("px", ""));
                console.log(graph_width);

                var scaleX = d3.scaleLog().domain([10, 150]).range([0, graph_width]).base(10);
                var scaleY = d3.scaleLog().domain([10, 150]).range([200, 0]).base(10);

                d3.select("svg").append("g").attr("transform", "translate(" + 50 + "," + 50 + ")")

                .selectAll()
                    .data(data)
                    .enter().append("circle")
                    .attr("cx", function(d) { return scaleX(d.AverageCityMPG); })
                    .on("click", function(d) {
                        console.log(d);
                    })
                    .attr("cy", function(d) { return scaleY(d.AverageHighwayMPG); })
                    .attr("r", function(d, i){return 2 + d.EngineCylinders;});
                
                
                var xAxis = d3.axisBottom(scaleX).tickValues([10, 20, 50, 100]).tickFormat(d3.format("~s"));
                var yAxis = d3.axisLeft(scaleY).tickValues([10, 20, 50, 100]).tickFormat(d3.format("~s"));

                d3.select('svg').append('g')
                .attr('transform', "translate("+margin+","+margin+")")
                .call(yAxis);

                d3.select('svg').append('g')
                .attr('transform', "translate("+margin+","+(height-margin)+")")
                .call(xAxis); 
                
            }    

        renderGraph();
    </script>
  </body>
</html>
